<!DOCTYPE html>
<html lang="en_us">
<head>
        <meta charset="utf-8" />
        <title>Interlines</title>
        <link rel="stylesheet" href="http://alexsavio.github.io/theme/css/main.css" />
        <link href="http://alexsavio.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Interlines Atom Feed" />
        <link href="http://alexsavio.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Interlines RSS Feed" />


        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/alexsavio">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://alexsavio.github.io/">Interlines  <strong>Lost in spikes</strong></a></h1>
                <nav><ul>
                    <li><a href="about.html">About</a></li>
                    <li><a href="http://www.ehu.es/ccwintco/index.php/Usuario:Alexsavio">My CV</a></li>
                    <li><a href="http://alexsavio.github.io/category/latex.html">LaTex</a></li>
                    <li><a href="http://alexsavio.github.io/category/python.html">Python</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="http://alexsavio.github.io/numpy_scipy_mkl.html">Compile Numpy and Scipy against Intel <span class="caps">MKL</span></a></h1>
<footer class="post-info">
        <abbr class="published" title="2014-04-08T22:00:00">
                Published: Tue 08 April 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://alexsavio.github.io/author/alexandre-savio.html">Alexandre Savio</a>
        </address>
<p>In <a href="http://alexsavio.github.io/category/python.html">Python</a>. </p>
<p>tags: <a href="http://alexsavio.github.io/tag/numpy.html">Numpy</a><a href="http://alexsavio.github.io/tag/scipy.html">Scipy</a><a href="http://alexsavio.github.io/tag/mkl.html">MKL</a></p>
</footer><!-- /.post-info --><h3>Install C++ Composer and <span class="caps">FORTRAN</span> Composer, with <span class="caps">MKL</span></h3>
<h6>Tested on Ubuntu&nbsp;13.10</h6>
<h4>Fill forms and download online installation shell scripts&nbsp;from:</h4>
<p>http://software.intel.com/en-us/non-commercial-software-development</p>
<h4>Execute shell scripts with&nbsp;sudo</h4>
<p>The libraries will be installed in&nbsp;/opt/intel</p>
<h4>Once installed, add this to&nbsp;~/.bashrc</h4>
<div class="codehilite"><pre>                #Intel C++ Studio
if [ -d /opt/intel ]; 
then
    export INTEL_HOME=/opt/intel
    export PATH=<span class="cp">${</span><span class="n">PATH</span><span class="cp">}</span>:<span class="cp">${</span><span class="n">INTEL_HOME</span><span class="cp">}</span>/bin
    export LD_LIBRARY_PATH=/opt/intel/mkl/lib/intel64:/opt/intel/lib/intel64:<span class="cp">${</span><span class="n">LD_LIBRARY_PATH</span><span class="cp">}</span>
fi
</pre></div>


<h4>Add this to&nbsp;/etc/ld.so.conf.d/intel.conf:</h4>
<div class="codehilite"><pre>            <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">intel64</span>
</pre></div>


<p>/opt/intel/lib/intel64/irml
/opt/intel/lib/intel64/crt&nbsp;/opt/intel/mkl/lib/intel64</p>
<h4>Open a new&nbsp;terminal.</h4>
<h4>Download Numpy and&nbsp;Scipy:</h4>
<p>http://www.scipy.org/scipylib/download.html</p>
<h4>Modify Numpy source&nbsp;code:</h4>
<div class="codehilite"><pre>            <span class="n">Change</span> <span class="n">directory</span> <span class="n">to</span> <span class="n">numpy</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span>
</pre></div>


<p>Create a site.cfg from the existing&nbsp;one</p>
<p>Edit site.cfg as&nbsp;follows:</p>
<p>Add the following lines to site.cfg in your top level NumPy directory to use Intel® <span class="caps">MKL</span>, if you are building on Intel 64 platform, assuming the default path for the Intel <span class="caps">MKL</span> installation from the Intel Parallel Studio <span class="caps">XE</span> 2013 or Intel Composer <span class="caps">XE</span> 2013&nbsp;versions:</p>
<p>[mkl]
library_dirs = /opt/intel/mkl/lib/intel64
include_dirs = /opt/intel/mkl/include
mkl_libs = mkl_rt
lapack_libs&nbsp;=</p>
<p>If you are building NumPy for 32 bit, please add as the&nbsp;following</p>
<p>[mkl] 
library_dirs = /opt/intel/mkl/lib/ia32
include_dirs = /opt/intel/mkl/include
mkl_libs = mkl_rt
lapack_libs&nbsp;=</p>
<p>Modify cc_exe in numpy/distutils/intelccompiler.py to be something&nbsp;like:</p>
<p>self.cc_exe = &#8216;icc -O3 -g -fPIC -fp-model strict -fomit-frame-pointer -openmp&nbsp;-xhost&#8217; </p>
<p>Here we use, -O3, optimizations for speed and enables more aggressive loop transformations such as Fusion, Block-Unroll-and-Jam, and collapsing <span class="caps">IF</span> statements, -openmp for OpenMP threading and -xhost option tells the compiler to generate instructions for the highest instruction set available on the compilation host processor. If you are using the <span class="caps">ILP64</span> interface, please add -DMKL_ILP64 compiler&nbsp;flag.</p>
<p>Run icc &#8212;help for more information on processor-specific options, and refer Intel Compiler documentation for more details on the various compiler&nbsp;flags.</p>
<p>Modify the the Fortran compiler flags in numpy-x.x.x/numpy/distutil/fcompiler/intel.py to use the following compiler options for the Intel Fortran&nbsp;Compiler:</p>
<p>For ia32 and&nbsp;Intel64</p>
<p>ifort -xhost -openmp -fp-model strict&nbsp;-fPIC</p>
<p>Modify the get_flags_opt function line to:
    return [&#8216;-xhost -openmp -fp-model&nbsp;strict&#8217;]</p>
<p>If you are using <span class="caps">ILP64</span> interface of Intel <span class="caps">MKL</span>, please add -i8 flag above.  If you are using older versions of Numpy/SciPy, please refer the new intel.py for your reference from the latest version of NumPy, which can be replaced to use the above mentioned compiler&nbsp;options.</p>
<h4>Compile Numpy and Scipy with the following command (once for Numpy and&nbsp;then</h4>
<p>once for&nbsp;Scipy):</p>
<p>Remember to activate the virtual environment if you are going to use this in&nbsp;one.</p>
<h5>For&nbsp;64-bit:</h5>
<div class="codehilite"><pre><span class="n">cd</span> <span class="o">&lt;</span><span class="n">numpy</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">config</span> <span class="o">--</span><span class="n">compiler</span><span class="o">=</span><span class="n">intelem</span> <span class="o">--</span><span class="n">fcompiler</span><span class="o">=</span><span class="n">intelem</span> <span class="n">build_clib</span>
</pre></div>


<p>&#8212;compiler=intelem &#8212;fcompiler=intelem build_ext &#8212;compiler=intelem
&#8212;fcompiler=intelem&nbsp;install</p>
<div class="codehilite"><pre><span class="n">cd</span> <span class="o">&lt;</span><span class="n">scipy</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">config</span> <span class="o">--</span><span class="n">compiler</span><span class="o">=</span><span class="n">intelem</span> <span class="o">--</span><span class="n">fcompiler</span><span class="o">=</span><span class="n">intelem</span> <span class="n">build_clib</span>
</pre></div>


<p>&#8212;compiler=intelem &#8212;fcompiler=intelem build_ext &#8212;compiler=intelem
&#8212;fcompiler=intelem&nbsp;install</p>
<h5>For&nbsp;32-bit:</h5>
<div class="codehilite"><pre><span class="n">cd</span> <span class="o">&lt;</span><span class="n">numpy</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">config</span> <span class="o">--</span><span class="n">compiler</span><span class="o">=</span><span class="n">intel</span> <span class="o">--</span><span class="n">fcompiler</span><span class="o">=</span><span class="n">intel</span> <span class="n">build_clib</span>
</pre></div>


<p>&#8212;compiler=intel &#8212;fcompiler=intel build_ext &#8212;compiler=intel &#8212;fcompiler=intel&nbsp;install</p>
<div class="codehilite"><pre><span class="n">cd</span> <span class="o">&lt;</span><span class="n">scipy</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">x</span><span class="o">&gt;</span>
<span class="n">python</span> <span class="n">setup</span><span class="p">.</span><span class="n">py</span> <span class="n">config</span> <span class="o">--</span><span class="n">compiler</span><span class="o">=</span><span class="n">intelem</span> <span class="o">--</span><span class="n">fcompiler</span><span class="o">=</span><span class="n">intelem</span> <span class="n">build_clib</span>
</pre></div>


<p>&#8212;compiler=intelem &#8212;fcompiler=intelem build_ext &#8212;compiler=intelem
&#8212;fcompiler=intelem&nbsp;install</p>
<h4>Troubleshooting:</h4>
<h5>Compiling Scipy: &#8220;Using deprecated NumPy <span class="caps">API</span>, disable it by&nbsp;&#8220;</h5>
<p>Maybe it is the version of <span class="caps">GCC</span>, try using 4.7 (worked on November&nbsp;2013).</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gcc</span><span class="o">-</span><span class="mf">4.7</span>
<span class="n">sudo</span> <span class="n">rm</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gcc</span>
<span class="n">sudo</span> <span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gcc</span><span class="o">-</span><span class="mf">4.7</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gcc</span>
</pre></div>


<p>Compile both Numpy and Scipy&nbsp;again.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="http://alexsavio.github.io/biblatex_lyx_jabref_encoding.html" rel="bookmark"
                           title="Permalink to Using BibLatex with Lyx and JabRef">Using BibLatex with Lyx and&nbsp;JabRef</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-02-27T18:11:46">
                Published: Thu 27 February 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://alexsavio.github.io/author/alexandre-m-savio.html">Alexandre M. Savio</a>
        </address>
<p>In <a href="http://alexsavio.github.io/category/latex.html">LaTex</a>. </p>
<p>tags: <a href="http://alexsavio.github.io/tag/latex.html">latex</a><a href="http://alexsavio.github.io/tag/lyx.html">lyx</a><a href="http://alexsavio.github.io/tag/bibtex.html">bibtex</a></p>
</footer><!-- /.post-info -->                <p>Configuring BibLatex in Lyx to benefit of UTF-8 encoding</p>
                <a class="readmore" href="http://alexsavio.github.io/biblatex_lyx_jabref_encoding.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://alexsavio.github.io/virtualenvwrapper.html" rel="bookmark"
                           title="Permalink to How to create virtualenvs with Virtualenvwrapper">How to create virtualenvs with&nbsp;Virtualenvwrapper</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-02-08T21:16:14">
                Published: Sat 08 February 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://alexsavio.github.io/author/alexandre-m-savio.html">Alexandre M. Savio</a>
        </address>
<p>In <a href="http://alexsavio.github.io/category/python.html">Python</a>. </p>
<p>tags: <a href="http://alexsavio.github.io/tag/python.html">python</a><a href="http://alexsavio.github.io/tag/virtualenv.html">virtualenv</a><a href="http://alexsavio.github.io/tag/install.html">install</a></p>
</footer><!-- /.post-info -->                <p>Create virtualenvs with virtualenvwrapper</p>
                <a class="readmore" href="http://alexsavio.github.io/virtualenvwrapper.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://alexsavio.github.io/web virtualenv.html" rel="bookmark"
                           title="Permalink to How to create a virtualenv for web development for Eve and MongoDB">How to create a virtualenv for web development for Eve and&nbsp;MongoDB</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-02-08T21:16:14">
                Published: Sat 08 February 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://alexsavio.github.io/author/alexandre-m-savio.html">Alexandre M. Savio</a>
        </address>
<p>In <a href="http://alexsavio.github.io/category/python.html">Python</a>. </p>
<p>tags: <a href="http://alexsavio.github.io/tag/python.html">python</a><a href="http://alexsavio.github.io/tag/virtualenv.html">virtualenv</a><a href="http://alexsavio.github.io/tag/web.html">web</a><a href="http://alexsavio.github.io/tag/mongodb.html">mongodb</a><a href="http://alexsavio.github.io/tag/eve.html">eve</a></p>
</footer><!-- /.post-info -->                <p>Create a virtualenv with web development framework Flask</p>
                <a class="readmore" href="http://alexsavio.github.io/web virtualenv.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="http://alexsavio.github.io/data-analysis-tools-install.html" rel="bookmark"
                           title="Permalink to Installing common Python data analysis tools in virtualenv">Installing common Python data analysis tools in&nbsp;virtualenv</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-02-08T20:44:37">
                Published: Sat 08 February 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="http://alexsavio.github.io/author/alexandre-m-savio.html">Alexandre M. Savio</a>
        </address>
<p>In <a href="http://alexsavio.github.io/category/python.html">Python</a>. </p>
<p>tags: <a href="http://alexsavio.github.io/tag/python.html">python</a><a href="http://alexsavio.github.io/tag/virtualenv.html">virtualenv</a><a href="http://alexsavio.github.io/tag/data.html">data</a></p>
</footer><!-- /.post-info -->                <p>Installing Python data analysis tools</p>
                <a class="readmore" href="http://alexsavio.github.io/data-analysis-tools-install.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://bcig.eu/">BCIG.EU</a></li>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://alexsavio.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>
                            <li><a href="http://alexsavio.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate">rss feed</a></li>

                            <li><a href="http://twitter.com/alex_savio">twitter</a></li>
                            <li><a href="http://github.com/alexsavio">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>